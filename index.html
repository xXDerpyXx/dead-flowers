<!DOCTYPE HTML>
<html>
<head>
<title>
Dead Flowers
</title>
</head>

<body width="800" height="600">
<canvas id="mainCanvas" width="800" height="600"></canvas>

<img width="0px" height="0px" src="images/frames/stand.png" id="stand"/>
<img width="0px" height="0px" src="images/frames/midair.png" id="midair"/>

<img width="0px" height="0px" src="images/frames/runright1.png" id="runright1"/>
<img width="0px" height="0px" src="images/frames/runright2.png" id="runright2"/>
<img width="0px" height="0px" src="images/frames/runright3.png" id="runright3"/>
<img width="0px" height="0px" src="images/frames/runright4.png" id="runright4"/>

<img width="0px" height="0px" src="images/frames/runleft1.png" id="runleft1"/>
<img width="0px" height="0px" src="images/frames/runleft2.png" id="runleft2"/>
<img width="0px" height="0px" src="images/frames/runleft3.png" id="runleft3"/>
<img width="0px" height="0px" src="images/frames/runleft4.png" id="runleft4"/>


<img width="0px" height="0px" src="images/background.png" id="background"/>

</body>

<style>

body{
	padding:0px;
	margin:0px;
	text-align:center;
	overflow:hidden;
}

</style>

<script>
	//require("./renderer.js");
	
	var c = document.getElementById("mainCanvas");
	var ctx = c.getContext("2d");
	var temp = 255;
	
	var img = document.getElementById("stand");
	var frame = 1;
	
	var x = 0;
	var y = 0;
	
	var yVel=0;
	var xVel=0;
	
	var right = false;
	var left = false;
	
	var speed = 5;
	
	
	
	
	//timer = setInterval(fixCanvasSize,100);
	
	function refresh(){
		//ctx.fillStyle="#FFFFFF";
		//ctx.fillRect(0,0,800,600);
		bimg = document.getElementById("background");
		ctx.drawImage(bimg,0,0,800,600);
	}
	
	function step(){
			refresh();
			ctx.fillStyle= "rgb("+0+","+temp+","+0+")";
			//console.log(img);
			try{
				ctx.drawImage(img,x,y,100,100);
			}catch(err){
				console.log("ERROR!");
				console.log(img);
				console.log(frame);
				console.log(Math.ceil(frame/100));
				console.log(err);
				clearInterval(timer);
			}
			
			frame+=Math.abs(xVel);
			console.log(frame);
			
			if(frame>=200){
				frame=1;
			}
			
			x+=xVel;
			y+=yVel;
			
			
			
			if(yVel == 0 && xVel == 0){
				img = document.getElementById("stand");
				frame=1;
			}else if(yVel !== 0 && (xVel<0.5 && xVel>-0.5)){
				img = document.getElementById("midair");
			}
			
			if(y<450){
				yVel+=20/1000;
			}else{
				yVel=((yVel/2)*-1)+1;
				y=450;
				if(yVel>0){
					yVel=0;
				}
			}
					
			if(xVel>0 && y==450){
				xVel=xVel-0.05;
				img=document.getElementById("runright"+Math.ceil(frame/50));
			}
			
			if(xVel<0 && y==450){
				xVel=xVel+0.05;
				img=document.getElementById("runleft"+Math.ceil(frame/50));
			}
			
			if(xVel<0.1 && xVel>-0.1){
				xVel=0;
			}
			
			if(x>800){
				x=-100;
			}
			if(x<-100){
				x=800;
			}
	}
			
	function cycle(){
		setTimeout(function(){
			step();
			cycle();
		},speed)
	}
	
	cycle();
			
	velCheck = setInterval(function(){
		if(right == true && xVel<3){
			xVel += 0.2;
		}
		
		if(left == true && xVel>-3){
			xVel += -0.2;
		}
	},1);
	
	window.onresize = function(event) {
		fixCanvasSize();
	};

	
	function fixCanvasSize(){
		var width = window.innerWidth
		|| document.documentElement.clientWidth
		|| document.body.clientWidth;

		var height = window.innerHeight
		|| document.documentElement.clientHeight
		|| document.body.clientHeight;
		
		document.getElementById("mainCanvas").style.width = width+"px";
		document.getElementById("mainCanvas").style.height = height+"px";
	}
	
	function slowDown(s,m){
		setTimeout(function(){
			speed=s;
			if(s<m){
				s++;
				slowDown(s,m);
			}
		},100);	
	}
	
	function speedUp(s,m){
		setTimeout(function(){
			speed=s;
			if(s>m){
				s--;
				speedUp(s,m);
			}
		},100);	
	}
	
	document.addEventListener("keydown", function(event) {
		key = event.keyCode;
		if(key == 13){
			slowDown(speed,25);
			setTimeout(function(){
				speedUp(speed,5);
			},10000);
		}
		if(key == 39){
			//xVel = 10;
			right = true;
		}
		if(key == 37){
			//xVel=-10;
			left = true;
		}
		if(key == 38 && y==450){
			yVel=-3;
		}
		console.log(key);
	});
	
	document.addEventListener("keyup", function(event) {
		key = event.keyCode;
		if(key == 39){
			//xVel = 10;
			right = false;
		}
		if(key == 37){
			//xVel=-10;
			left = false;
		}
		if(key == 38){
			yVel+=1;
		}
	});
	
	fixCanvasSize();
	
</script>

</html>
